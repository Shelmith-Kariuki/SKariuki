---
title: "Extracting crucial details from M-Pesa text messages"
author: "Shelmith"
date: 2021-04-28
tags:
  - R
summary: 
featured: no
disable_jquery: no
image:
  caption: 
  focal_point: Smart
  preview_only: yes
  
output:
  blogdown::html_page:
    toc: false
    toc_depth: 6
    number_sections: false
    fig_width: 16
---

<script src="//rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="//rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="//rmarkdown-libs/anchor-sections/anchor-sections.js"></script>
<script src="//rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="//rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />


<p><a href="https://www.safaricom.co.ke/about">M-PESA</a>, operated by <a href="https://www.safaricom.co.ke/">Safaricom</a> is a mobile money transfer service in Kenya. It is one of the best online payment options. One can use M-PESA to buy airtime, send or receive cash on their phones and pay goods and/or services using merchant paybill numbers or till numbers. The following is an example of an M-Pesa text message that one would receive if they paid for goods or services via a till number.</p>
<blockquote>
<p>XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#</p>
</blockquote>
<p>This script details how one can extract some key details from the message for purposes of data analysis. These details include the transaction code, transaction type (purchase of airtime, cash transfer, cash withdrawal, cash deposit, pay bill payment, merchant payment (Lipa Na Mpesa)), date (including the day, month and year), time (hour, minute and time of day (morning / afternoon)) , transaction amount , and M-Pesa balance.</p>
<p><em>Note: This data has been anonymized</em></p>
<div id="load-the-packages-required" class="section level3">
<h3>0. Load the packages required</h3>
<pre class="r"><code>
## Create a vector of packages to be installed
pkgs &lt;- c(&quot;tidyverse&quot;,&quot;lubridate&quot;, &quot;kableExtra&quot;)

## Check if there are packages you want to load, that are not already installed. 
miss_pkgs &lt;- pkgs[!pkgs %in% installed.packages()[,1]] 

## Installing the missing packages
if(length(miss_pkgs)&gt;0){
  install.packages(miss_pkgs)
}
## Loading all the packages
invisible(lapply(pkgs,library,character.only=TRUE))

## Remove the objects that are no longer required
rm(miss_pkgs)
rm(pkgs)</code></pre>
</div>
<div id="read-in-the-data" class="section level3">
<h3>1. Read in the data</h3>
<pre class="r"><code>df &lt;- read_csv(&quot;mpesa.csv - Sheet1.csv&quot;)
#&gt; Parsed with column specification:
#&gt; cols(
#&gt;   `Text message` = col_character()
#&gt; )
tab_output(df)</code></pre>
<table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
Text message
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
XXXYYYZZZ1 confirmed.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ2 confirmed.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ3 Confirmed. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ4 Confirmed. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ5 Confirmed. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ6 Confirmed.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ9 Confirmed. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ11 Confirmed. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
</tr>
</tbody>
</table>
</div>
<div id="extract-crucial-information-from-the-messages" class="section level3">
<h3>2. Extract crucial information from the messages</h3>
<div id="transaction-code" class="section level4">
<h4>2.1 Transaction code</h4>
<pre class="r"><code>df &lt;- df %&gt;% 
      mutate(trn_code = 
               gsub(&quot;confirmed.*|Confirmed.*&quot;, &quot;&quot;, `Text message`))
tab_output(df)</code></pre>
<table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
Text message
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_code
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
XXXYYYZZZ1 confirmed.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ1
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ2 confirmed.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ2
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ3 Confirmed. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ3
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ4 Confirmed. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ4
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ5 Confirmed. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ5
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ6 Confirmed.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ6
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ9 Confirmed. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ9
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ10
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ11 Confirmed. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
<td style="text-align:center;">
XXXYYYZZZ11
</td>
</tr>
</tbody>
</table>
</div>
<div id="transaction-type" class="section level4">
<h4>2.2 Transaction type</h4>
<pre class="r"><code>df &lt;- df %&gt;% 
  mutate(trn_type = 
           ## Purchase of airtime
           ifelse(`Text message` %in% 
                    grep(&quot;airtime&quot;, `Text message`,value = TRUE, 
                         ignore.case = TRUE), &quot;Airtime Purchase&quot;,
           ## Transfer
           ifelse(`Text message` %in% 
                    grep(&quot;sent to&quot;, `Text message`,value = TRUE, 
                         ignore.case = TRUE) &amp;
                    !`Text message` %in% 
                    grep(&quot;for account&quot;, `Text message`,value = TRUE, 
                         ignore.case = TRUE), &quot;Customer Transfer&quot;, 
           ## Withdrawal
           ifelse(`Text message` %in% 
                    grep(&quot;withdraw&quot;, `Text message`,value = TRUE, 
                         ignore.case = TRUE), &quot;Withdrawal&quot;,
           ## Deposit
           ifelse(`Text message` %in% 
                    grep(&quot;Give&quot;, `Text message`,value = TRUE, 
                         ignore.case = TRUE), &quot;Deposit&quot;,         
           ## Pay Bill Payment
           ifelse(`Text message` %in% 
                    grep(&quot;for account&quot;, `Text message`,value = TRUE, 
                         ignore.case = TRUE), &quot;Pay Bill Payment&quot;,
           ## Merchant Payment (Lipa Na Mpesa)
           ifelse(`Text message` %in% 
                    grep(&quot;paid to&quot;, `Text message`,value = TRUE, 
                         ignore.case = TRUE), &quot;Merchant Payment&quot;,&quot;&quot;)))))))
tab_output(df)</code></pre>
<table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
Text message
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_code
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
XXXYYYZZZ1 confirmed.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ1
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ2 confirmed.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ2
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ3 Confirmed. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ3
</td>
<td style="text-align:center;">
Pay Bill Payment
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ4 Confirmed. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ4
</td>
<td style="text-align:center;">
Merchant Payment
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ5 Confirmed. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ5
</td>
<td style="text-align:center;">
Customer Transfer
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ6 Confirmed.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ6
</td>
<td style="text-align:center;">
Withdrawal
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ9 Confirmed. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ9
</td>
<td style="text-align:center;">
Customer Transfer
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ10
</td>
<td style="text-align:center;">
Merchant Payment
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ11 Confirmed. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
<td style="text-align:center;">
XXXYYYZZZ11
</td>
<td style="text-align:center;">
Deposit
</td>
</tr>
</tbody>
</table>
</div>
<div id="date-day-month-year" class="section level4">
<h4>2.3 Date (Day, Month, Year)</h4>
<pre class="r"><code>## Date
df &lt;- df %&gt;% 
  mutate(temp = gsub(&quot;.*confirmed|.*Confirmed&quot;, &quot;&quot;, `Text message`)) %&gt;% 
  mutate(trn_date = str_match(temp, regex(&quot;on\\s*(.*?)\\s*at&quot;, 
                                          ignore_case = TRUE))[,2],
         trn_date = as.Date(trn_date, format = &#39;%d/%m/%y&#39;)) 


## Day, Month, Year
df &lt;- df %&gt;% 
  mutate(trn_day = day(trn_date),
         trn_dayofweek = wday(trn_date, label = TRUE, abbr = FALSE),
         trn_month = month(trn_date, label = TRUE, abbr = FALSE),
         trn_year = year(trn_date))
tab_output(df)</code></pre>
<table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
Text message
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_code
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_type
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
temp
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_date
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_day
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_dayofweek
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_month
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_year
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
XXXYYYZZZ1 confirmed.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ1
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
2021-04-27
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
Tuesday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ2 confirmed.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ2
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
2021-04-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Sunday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ3 Confirmed. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ3
</td>
<td style="text-align:center;">
Pay Bill Payment
</td>
<td style="text-align:center;">
. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ4 Confirmed. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ4
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ5 Confirmed. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ5
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ6 Confirmed.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ6
</td>
<td style="text-align:center;">
Withdrawal
</td>
<td style="text-align:center;">
.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ9 Confirmed. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ9
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
2021-04-12
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
Monday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ10
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
2021-03-17
</td>
<td style="text-align:center;">
17
</td>
<td style="text-align:center;">
Wednesday
</td>
<td style="text-align:center;">
March
</td>
<td style="text-align:center;">
2021
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ11 Confirmed. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
<td style="text-align:center;">
XXXYYYZZZ11
</td>
<td style="text-align:center;">
Deposit
</td>
<td style="text-align:center;">
. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
<td style="text-align:center;">
2020-07-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Saturday
</td>
<td style="text-align:center;">
July
</td>
<td style="text-align:center;">
2020
</td>
</tr>
</tbody>
</table>
</div>
<div id="time-hour-minute-time-of-day-morning-afternoon" class="section level4">
<h4>2.4 Time (Hour, Minute, Time of day (morning / afternoon))</h4>
<pre class="r"><code>df &lt;- df %&gt;% 
  mutate(temp = gsub(&quot;.*confirmed|.*Confirmed&quot;, &quot;&quot;, `Text message`))%&gt;%
  mutate(trn_time = 
           str_match(temp, regex(&quot;at\\s*(.*?)\\s*New M-PESA balance&quot;, 
      ignore_case = TRUE))[,2],
        trn_time = gsub(&quot;Withdraw.*|Give.*|\\.&quot;, &quot;&quot;, trn_time), 
        trn_time) %&gt;%
  mutate(trn_timeofday = 
           ifelse(trn_time %in% grep(&quot;PM&quot;, trn_time,
                ignore.case = FALSE, value = TRUE), &quot;Afternoon&quot;,
                ifelse(trn_time %in% grep(&quot;AM&quot;, trn_time, 
                      ignore.case = FALSE, value = TRUE), &quot;Morning&quot;,&quot;&quot;))) %&gt;% 
  mutate(trn_time = trimws(gsub(&quot;AM|PM&quot;, &quot;&quot;, trn_time))) %&gt;% 
  separate(trn_time, into = c(&quot;trn_hour&quot;, &quot;trn_minute&quot;),
           sep = &quot;:&quot;, remove = FALSE) %&gt;% 
  mutate(across(c(trn_hour, trn_minute), ~as.numeric(trimws(.)))) %&gt;% 
  mutate(trn_hour = ifelse(trn_timeofday == &quot;Afternoon&quot;, 
                           trn_hour + 12, trn_hour)) %&gt;% 
  select(-temp) 

tab_output(df)</code></pre>
<table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
Text message
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_code
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_type
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_date
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_day
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_dayofweek
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_month
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_year
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_time
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_hour
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_minute
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_timeofday
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
XXXYYYZZZ1 confirmed.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ1
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
2021-04-27
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
Tuesday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
11:05
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
Morning
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ2 confirmed.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ2
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
2021-04-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Sunday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
3:45
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
45
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ3 Confirmed. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ3
</td>
<td style="text-align:center;">
Pay Bill Payment
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
9:57
</td>
<td style="text-align:center;">
21
</td>
<td style="text-align:center;">
57
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ4 Confirmed. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ4
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
3:26
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
26
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ5 Confirmed. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ5
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
2:38
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
38
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ6 Confirmed.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ6
</td>
<td style="text-align:center;">
Withdrawal
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
12:31
</td>
<td style="text-align:center;">
24
</td>
<td style="text-align:center;">
31
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ9 Confirmed. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ9
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
2021-04-12
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
Monday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
1:57
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
57
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ10
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
2021-03-17
</td>
<td style="text-align:center;">
17
</td>
<td style="text-align:center;">
Wednesday
</td>
<td style="text-align:center;">
March
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
6:54
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
54
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ11 Confirmed. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
<td style="text-align:center;">
XXXYYYZZZ11
</td>
<td style="text-align:center;">
Deposit
</td>
<td style="text-align:center;">
2020-07-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Saturday
</td>
<td style="text-align:center;">
July
</td>
<td style="text-align:center;">
2020
</td>
<td style="text-align:center;">
3:29
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
29
</td>
<td style="text-align:center;">
Afternoon
</td>
</tr>
</tbody>
</table>
</div>
<div id="transaction-amount" class="section level4">
<h4>2.5 Transaction amount</h4>
<pre class="r"><code>df &lt;- df %&gt;% 
  mutate(temp = gsub(&quot;New M-PESA balance is.*&quot;, &quot;&quot;, `Text message`)) %&gt;% 
  mutate(trn_amount = str_extract(temp, &quot;(?&lt;=^| )Ksh.*?(?=$| )&quot;)) %&gt;% 
  mutate(trn_amount = as.numeric(trimws(gsub(&quot;Ksh|Kshs|,&quot;, &quot;&quot;, 
                                             trn_amount)))) %&gt;% 
  select(-temp)

tab_output(df)</code></pre>
<table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
Text message
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_code
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_type
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_date
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_day
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_dayofweek
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_month
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_year
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_time
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_hour
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_minute
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_timeofday
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_amount
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
XXXYYYZZZ1 confirmed.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ1
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
2021-04-27
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
Tuesday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
11:05
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
Morning
</td>
<td style="text-align:center;">
100
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ2 confirmed.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ2
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
2021-04-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Sunday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
3:45
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
45
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
30
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ3 Confirmed. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ3
</td>
<td style="text-align:center;">
Pay Bill Payment
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
9:57
</td>
<td style="text-align:center;">
21
</td>
<td style="text-align:center;">
57
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
500
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ4 Confirmed. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ4
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
3:26
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
26
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
607
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ5 Confirmed. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ5
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
2:38
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
38
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
1030
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ6 Confirmed.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ6
</td>
<td style="text-align:center;">
Withdrawal
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
12:31
</td>
<td style="text-align:center;">
24
</td>
<td style="text-align:center;">
31
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
1500
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ9 Confirmed. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ9
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
2021-04-12
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
Monday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
1:57
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
57
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
80
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ10
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
2021-03-17
</td>
<td style="text-align:center;">
17
</td>
<td style="text-align:center;">
Wednesday
</td>
<td style="text-align:center;">
March
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
6:54
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
54
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
700
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ11 Confirmed. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
<td style="text-align:center;">
XXXYYYZZZ11
</td>
<td style="text-align:center;">
Deposit
</td>
<td style="text-align:center;">
2020-07-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Saturday
</td>
<td style="text-align:center;">
July
</td>
<td style="text-align:center;">
2020
</td>
<td style="text-align:center;">
3:29
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
29
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
2000
</td>
</tr>
</tbody>
</table>
</div>
<div id="m-pesa-balance" class="section level4">
<h4>2.6 M-Pesa balance</h4>
<pre class="r"><code>df &lt;- df %&gt;% 
  mutate(temp = gsub(&quot;.*New M-PESA balance is&quot;, &quot;&quot;, `Text message`),
         temp = gsub(&quot;Transaction cost.*|\\..*&quot;, &quot;&quot;, temp)) %&gt;% 
  mutate(trn_balance = as.numeric(trimws(gsub(&quot;Ksh|Kshs|,|\\.&quot;, &quot;&quot;, 
                                              temp)))) %&gt;% 
  select(-temp)

tab_output(df)</code></pre>
<table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
Text message
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_code
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_type
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_date
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_day
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_dayofweek
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_month
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_year
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_time
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_hour
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_minute
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_timeofday
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_amount
</th>
<th style="text-align:center;font-weight: bold;color: black !important;background-color: pink !important;">
trn_balance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
XXXYYYZZZ1 confirmed.You bought Ksh100.00 of airtime on 27/4/21 at 11:05 AM.New M-PESA balance is Ksh5,350.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,900.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ1
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
2021-04-27
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
Tuesday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
11:05
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
Morning
</td>
<td style="text-align:center;">
100
</td>
<td style="text-align:center;">
5350
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ2 confirmed.You bought Ksh30.00 of airtime on 25/4/21 at 3:45 PM.New M-PESA balance is Ksh5,450.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,940.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ2
</td>
<td style="text-align:center;">
Airtime Purchase
</td>
<td style="text-align:center;">
2021-04-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Sunday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
3:45
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
45
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
30
</td>
<td style="text-align:center;">
5450
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ3 Confirmed. Ksh500.00 sent to KPLC PREPAID for account 123456789 on 23/4/21 at 9:57 PM New M-PESA balance is Ksh5,941.22. Transaction cost, Ksh23.00. Amount you can transact within the day is 296,283.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ3
</td>
<td style="text-align:center;">
Pay Bill Payment
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
9:57
</td>
<td style="text-align:center;">
21
</td>
<td style="text-align:center;">
57
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
500
</td>
<td style="text-align:center;">
5941
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ4 Confirmed. Ksh607.00 paid to SUPERMARKET FULANI HAPO. on 23/4/21 at 3:26 PM.New M-PESA balance is Ksh6,494.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,813.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ4
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
3:26
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
26
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
607
</td>
<td style="text-align:center;">
6494
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ5 Confirmed. Ksh1,030.00 sent to MSEE FULANI HAPO +254722222222 on 23/4/21 at 2:38 PM. New M-PESA balance is Ksh7. Transaction cost, Ksh22.00. Amount you can transact within the day is 297,420.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ5
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
2:38
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
38
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
1030
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ6 Confirmed.on 23/4/21 at 12:31 PMWithdraw Ksh1,500.00 from 010000 - Shop fulani hapo New M-PESA balance is Ksh8. Transaction cost, Ksh28.00. Amount you can transact within the day is 298,500.00.
</td>
<td style="text-align:center;">
XXXYYYZZZ6
</td>
<td style="text-align:center;">
Withdrawal
</td>
<td style="text-align:center;">
2021-04-23
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
Friday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
12:31
</td>
<td style="text-align:center;">
24
</td>
<td style="text-align:center;">
31
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
1500
</td>
<td style="text-align:center;">
8
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ9 Confirmed. Ksh80.00 sent to MSEE WA CHIPO 0704444444 on 12/4/21 at 1:57 PM. New M-PESA balance is Ksh 210. Transaction cost, Ksh0.00. Amount you can transact within the day is 296,665.00. SAFARICOM ONLY CALLS YOU FROM 0722000000. To reverse, forward this message to 456.
</td>
<td style="text-align:center;">
XXXYYYZZZ9
</td>
<td style="text-align:center;">
Customer Transfer
</td>
<td style="text-align:center;">
2021-04-12
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
Monday
</td>
<td style="text-align:center;">
April
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
1:57
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
57
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
80
</td>
<td style="text-align:center;">
210
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ10 Confirmed. Ksh700.00 paid to GEL NAIL SHOP. on 17/3/21 at 6:54 PM.New M-PESA balance is Ksh3,646.22. Transaction cost, Ksh0.00. Amount you can transact within the day is 299,300.00.You can now access M-PESA via *334#
</td>
<td style="text-align:center;">
XXXYYYZZZ10
</td>
<td style="text-align:center;">
Merchant Payment
</td>
<td style="text-align:center;">
2021-03-17
</td>
<td style="text-align:center;">
17
</td>
<td style="text-align:center;">
Wednesday
</td>
<td style="text-align:center;">
March
</td>
<td style="text-align:center;">
2021
</td>
<td style="text-align:center;">
6:54
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
54
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
700
</td>
<td style="text-align:center;">
3646
</td>
</tr>
<tr>
<td style="text-align:center;">
XXXYYYZZZ11 Confirmed. On 25/7/20 at 3:29 PM Give Ksh2,000.00 cash to Agent fulani New M-PESA balance is Ksh2,100.22.
</td>
<td style="text-align:center;">
XXXYYYZZZ11
</td>
<td style="text-align:center;">
Deposit
</td>
<td style="text-align:center;">
2020-07-25
</td>
<td style="text-align:center;">
25
</td>
<td style="text-align:center;">
Saturday
</td>
<td style="text-align:center;">
July
</td>
<td style="text-align:center;">
2020
</td>
<td style="text-align:center;">
3:29
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
29
</td>
<td style="text-align:center;">
Afternoon
</td>
<td style="text-align:center;">
2000
</td>
<td style="text-align:center;">
2100
</td>
</tr>
</tbody>
</table>
<style>
body {text-align: justify}
</style>
</div>
</div>
